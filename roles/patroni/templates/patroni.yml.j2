scope: {{ cluster_name }}
namespace: /service/
name: {{ inventory_hostname }}

restapi:
  listen: 0.0.0.0:8008
  connect_address: {{ ansible_host }}:8008

etcd3:
  hosts: {% for node in etcd_nodes %}{{ node.ip }}:2379{% if not loop.last %},{% endif %}{% endfor %}

bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    maximum_lag_on_failover: 1048576

  initdb:
    - encoding: UTF8
    - data-checksums

  users:
    replication:
      password: "{{ replication_password }}"
      options:
        - replication
    postgres:
      password: "{{ postgres_superuser_password }}"

  pg_hba: 
   - host replication replication 10.10.10.0/24 scram-sha-256
   - host replication replication 127.0.0.1/32 trust 
   - host replication replication ::1/128 trust 
   - host all all 10.10.10.0/24 scram-sha-256
   - host all all 127.0.0.1/32 trust 
   - host all all ::1/128 trust

postgresql:
  listen: 0.0.0.0:{{ postgres_port }}
  connect_address: {{ ansible_host }}:{{ postgres_port }}
  data_dir: /var/lib/postgresql/{{ postgres_version }}/main
  bin_dir: /usr/lib/postgresql/{{ postgres_version }}/bin
  authentication:
    replication:
      username: {{ replication_user }}
      password: "{{ replication_password }}"
    superuser:
      username: {{ postgres_superuser_user }}
      password: "{{ postgres_superuser_password }}"
  pg_hba: 
   - host replication replication 10.10.10.0/24 scram-sha-256 
   - host replication replication 127.0.0.1/32 trust 
   - host replication replication ::1/128 trust 
   - host all all 10.10.10.0/24 scram-sha-256 
   - host all all 127.0.0.1/32 trust 
   - host all all ::1/128 trust
